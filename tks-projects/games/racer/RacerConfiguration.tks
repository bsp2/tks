
module MRacerConfiguration;

class RacerConfiguration {

   //define String VERSION_STRING = "081221";
   define String VERSION_STRING = "140321";

   define int DRAWMODE_NONE   = 0; // do not draw track
   define int DRAWMODE_POINTS = 1; // GL_POINTS
   define int DRAWMODE_FLAT   = 2; // flat shaded triangles
   define int DRAWMODE_TEX    = 3; // textured triangles
   define int NUM_DRAWMODES   = 4;

   define int HIMODE_NORMAL = 0;
   define int HIMODE_AUTHOR = 1;
   define int HIMODE_GOLD   = 2;
   define int HIMODE_SILVER = 3;
   define int HIMODE_BRONZE = 4;

   define float PREV5_SCALE = 100; // old maps < v5 use 100* the size (causing cam bugs at map edges)

   static String current_map_name = "???";

   static int hiscore_mode = HIMODE_NORMAL;
   static boolean b_replay = false;
   static boolean b_replay_fail = maybe;
   static boolean b_record = false;
   //static boolean b_always_boost = false;
   static boolean b_always_boost = true;
   static boolean b_debug_keys = false;
   //static boolean b_motion_blur = true;
   static boolean b_motion_blur = false;
   static boolean b_fog = true;
   static boolean b_tri_optimizer = true;
   //static boolean b_tri_optimizer = false;
   static boolean b_stencil_shadows = true;
   static boolean b_use_vbo = true;
   static boolean b_draw_skybox = true;
   //static boolean b_draw_skybox = false; // xxx 
   static boolean b_multisampling = false;
   static boolean b_draw_facenormals = false;
   static boolean b_draw_edgenormals = false;
   static boolean b_draw_colltris = false;
   static boolean b_debug_cam = false;
   static boolean b_draw_forces = false;
   static boolean b_draw_debug_sphere = false;
   static boolean b_draw_grid = false;
   static boolean b_draw_coll = false;
   static boolean b_springs = true;
   static boolean b_color_tris = false; // false="solid" color, true=show triangles
   static boolean b_debug_collision = false;
   static boolean b_draw_ship = true;
   static boolean b_halt_collision = false;
   static boolean i_draw_mode = DRAWMODE_TEX; // 0 = draw none, 1= draw dots, 2 = draw flat shaded triangles, 3 = draw textured triangles
   //static boolean i_draw_mode = DRAWMODE_FLAT; // 0 = draw none, 1= draw dots, 2 = draw flat shaded triangles, 3 = draw textured triangles
   static boolean b_texture_filter = false;
   static boolean b_texture_perspective_correction = true;
   static boolean b_invert_texture_anim_dir = false;
   static boolean b_autoflip = false; // true=auto-flip ship
   static boolean b_joy_axis_accel = false;
   static boolean b_allow_boost = true;
   static boolean b_ingame = true; // true=do timemeasuring, tick player..
   static float race_millisec;
   static float race_millisec_hiscore;
   static float race_millisec_old_hiscore;
   //static float race_bestlap_millisec;
   //static float race_bestlap_millisec_hiscore;
   static boolean b_slomo = false;
   static boolean b_wiimote = true; // 1=Wiimote via GlovePIE, 2=PS2 joypad

   // editor:
   static boolean b_edit = false; // true=track edit mode, false=ingame mode
   static boolean b_edit_env = false; // true= edit envelope, false=regular edit mode
   static boolean b_path_edit = false; // true= edit path shape, false=regular or envedit mode 

   static NextDrawMode() {
      i_draw_mode = (i_draw_mode + 1) % NUM_DRAWMODES;
   }

   static ToggleDebugKeys() {
      b_debug_keys = ! b_debug_keys;
      trace "[...] RacerConfiguration: b_debug_keys is now "+b_debug_keys;
   }

   static ToggleTextureAnimDir() {
      b_invert_texture_anim_dir = ! b_invert_texture_anim_dir;
      trace "[...] RacerConfiguration: b_invert_texture_anim_dir is now "+b_invert_texture_anim_dir;
   }

   static ToggleAllowBoost() {
      b_allow_boost = ! b_allow_boost;
      trace "[...] RacerConfiguration: b_allow_boost is now "+b_allow_boost;
   }

   static ToggleShadows() {
      b_stencil_shadows = ! b_stencil_shadows;
      trace "[...] RacerConfiguration: b_stencil_shadows is now "+b_stencil_shadows;
   }

   static ToggleFog() {
      b_fog = ! b_fog;
      trace "[...] RacerConfiguration: b_fog is now "+b_fog;
   }

   static ToggleTriOptimizer() {
      b_tri_optimizer = ! b_tri_optimizer;
      trace "[...] RacerConfiguration: b_tri_optimizer is now "+b_tri_optimizer;
   }

   static ToggleJoyAxisAccel() {
      b_joy_axis_accel = ! b_joy_axis_accel;
      trace "[...] RacerConfiguration: b_joy_axis_accel is now "+b_joy_axis_accel;
   }

   static ToggleMotionBlur() {
      b_motion_blur = ! b_motion_blur;
      trace "[...] RacerConfiguration: b_motion_blur is now "+b_motion_blur;
   }

   static ToggleMultisampling() {
      b_multisampling = ! b_multisampling;
      trace "[...] RacerConfiguration: b_multisampling is now "+(b_multisampling ? "enabled" : "disabled")+".";
   }

   static method AppendTimeString(String r, int millisec) {
      Integer sec = millisec / 1000;
      Integer msec = (millisec - (sec * 1000)) / 10;
      Integer min = sec / 60;
      sec = sec - (min * 60);
      r.append( min.printf("%02d") + ":" + sec.printf("%02d") + ":" + msec.printf("%02d") );
   }

   static ToggleSlomo() {
      b_slomo = ! b_slomo;
      trace "[...] RacerConfiguration: b_slomo is now " + b_slomo;
   }
}
