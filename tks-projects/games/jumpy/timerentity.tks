
// 14Mar2010, 18Mar2010

module MTimerEntity;

namespace jumpy;


class TimerEntity extends BoxEntity {

   protected float timeout;
   protected float countdown;

   public Script expire_script;
   public Script abort_script;


   public static NewTimerEntity(int _timeout) : TimerEntity {
      TimerEntity t <= new TimerEntity;
      t.timeout = _timeout;
      return deref t;
   }

   public virtual calc(float dt) {
      if(!b_active)
      {
         if(countdown > 0)
         {
            countdown -= dt;
            if(countdown <= 0)
            {
               countdown = 0;
               expire_script.run();
            }
         }
      }
   }

   public virtual draw(float dt) {
      return;
   }

   public virtual hitBy(Entity _o) : int {
      return 0;
   }

   public virtual actionActivate() {
      countdown = timeout;
   }

   public virtual actionDeactivate() {
      countdown = 0;
      abort_script.run();
   }

   public virtual actionSet(String key, value) : boolean {
      StringArray *a;
      switch(key)
      {
         case "timeout":
            timeout = value;
            return true;
      }
      return BoxEntity::actionSet(key, value);
   }

   public virtual markScriptTargets() {
      expire_script.markScriptTargets();
      abort_script.markScriptTargets();
   }

}
