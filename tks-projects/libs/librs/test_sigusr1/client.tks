// 20Aug2024

//  +0: host pid
//  +4: client pid
//  +8: request data from client (iter)
// +12: reply data from host (-request data)
SharedBuffer sh;
if(sh.visitSharedMemory("test_sigusr1", 16+256*1024))
{
   int hostPID = sh.peekI32(0);
   if(hostPID > 0)
   {
      sh.pokeI32(4, Process.GetPID());
      int tStart = milliSeconds();
      int iter = 0;
      loop(10000)
      {
         sh.pokeI32(8, iter);
         Process.SendSignal_SIGUSR1(hostPID);
         // Thread.Yield();  // (a bit) slower with Yield()
         Process.WaitSignal_SIGUSR1();
         int reply = sh.peekI32(12);
         if(reply != -iter)
            trace "xxx invalid host reply="+reply;
         iter++;
      }
      trace "xxx client: "+iter+" iterations in tDelta="+(milliSeconds()-tStart)+" ms";
   }
   else
      trace "xxx client: invalid hostPID="+hostPID;
   
}
trace "client: cu";

// =>
// % tks client.tks
// xxx client: 10000 iterations in tDelta=81 ms
