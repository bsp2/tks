// 17Aug2024, 18Aug2024

RemoteScriptPort rsHost;
RemoteScriptPort rsClient;

// trace "xxx library_path=\""+TKS.tksLibraryPath+"\"";

int maxReqSz = 1*1024;

if(rsHost.create("test_host", maxReqSz))
{
   trace "[...] host: awaiting req";
   Buffer bufRecv; bufRecv.size = maxReqSz;
   Buffer bufSend; bufSend.size = maxReqSz;
   Integer reqIdx = 0;
   for(;;)
   {
      // wait for request
      if(rsHost.recv(bufRecv))
      {
         trace "[dbg] host: ["+reqIdx.printf("%05d")+"] rev'd "+bufRecv.offset+" bytes";
         bufRecv.offset = 0;
         String clientId; clientId << bufRecv;
         trace "[dbg] host: ["+reqIdx.printf("%05d")+"] new clientId=\""+clientId+"\"";
         if(rsClient.connect(clientId, maxReqSz))
         {
            bufSend.offset = 0;
            bufSend << "hello from test_host";
            rsClient.send(bufSend);
            trace "[dbg] host: ["+reqIdx.printf("%05d")+"] sent "+bufSend.offset+" reply bytes";
            rsClient.disconnect();
         }
         // break;
         reqIdx++;
      }
      TKS.sleep(1);
   }
   rsHost.disconnect();
}
