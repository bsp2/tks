// ----
// ---- file   : claprescan.tks
// ---- author : Bastian Spiegel <bs@tkscript.de>
// ---- legal  : (c) 2024 by Bastian Spiegel.
// ----          Distributed under terms of the GNU LESSER GENERAL PUBLIC LICENSE (LGPL). See
// ----          http://www.gnu.org/licenses/licenses.html#LGPL or COPYING for further information.
// ----
// ---- info   : Rescan all CLAP plugins (incrementally)
// ----
// ---- created: 03Jul2024
// ----
// ----
// ----

class Utils {
   static GetTKSPathName() : String {
      local String r <= Utils.ToNativePathName(TKS.tksExePath);
      r.replace(".bin", "");  // exec the wrapper script, not the executable (plugin/library paths)
      return deref r;
   }
}

int iter = 0;
int maxIter = 50;
loop(maxIter)
{
   iter++;
   int r = system("\""+Utils.GetTKSPathName()+"\" eureka rescan_clap");
   // trace "[dbg] vst2scanall["+iter+"/"+maxIter+"]: r="+r;
   if(0 == r)
   {
      trace "[...] claprescan["+iter+"/"+maxIter+"]: plugin scan done, exiting.";
      break;
   }
   else
   {
      trace "[...] claprescan["+iter+"/"+maxIter+"]: plugin scan incomplete, continuing..";
   }
}
