// ----
// ---- file   : NMM_SavePresetDialog.tks
// ---- author : Bastian Spiegel <bs@tkscript.de>
// ---- legal  : (c) 2006-2017 by Bastian Spiegel.
// ----          Distributed under terms of the GNU LESSER GENERAL PUBLIC LICENSE (LGPL). See
// ----          http://www.gnu.org/licenses/licenses.html#LGPL or COPYING for further information.
// ----
// ---- info   : This is part of the "syntracker" sequencer.
// ----
// ---- changed: 14Sep2006, ..., 28Feb2011, 23Jan2015, 27Jan2015, 09Mar2015, 07Nov2015, 10Mar2017
// ----
// ----
// ----
module MNMM_SavePresetDialog;

use namespace ui;
use namespace st2;


class NMM_SavePresetDialog extends ActionConsumer {
   TextInputDialog *d;
   NodeModMatrixEditor *editor;

   public method run(NodeModMatrixEditor _editor) {
      editor <= _editor;

      d <= TextInputDialog.New("Save preset",
                               "Please enter preset name:",
                               "\aSave",
                               "Cancel",
                               editor.last_preset_name,
                               255, 16,
                               this
                               );
      d.showNearMouse(10,-20);
   }

   public virtual consumeAction(Action _action) : boolean {
      if(_action instanceof StringAction)
      {
         StringAction sac <= _action;
         if(sac.getActionProvider() == d)
         {
            d <= null; // Delete dialog
            if(sac.getActionName() == TextInputDialog.ACTION_TEXTINPUTDIALOGCLOSED)
            {
               String name = sac.getStringValue();
               if(!name.isBlank())
               {
                  editor.handlePresetSave2(name);
                  return true;
               }
            }
         }
      }
      return true;
   }
}
