
String templV;
if(templV.loadLocal("yamaha_fs1r_opv.msp_templ", true/*bRemoveCR*/))
{
   String templN;
   if(templN.loadLocal("yamaha_fs1r_opn.msp_templ", true/*bRemoveCR*/))
   {
      String outV;
      outV.alloc(1024*256);
      String outN;
      outN.alloc(1024*256);
      String s;
      int opNr = 1;
      int nrVoiced = 20;
      int nrUnvoiced = 21;
      int syxOff = 164;
      loop(8)
      {
         // Voiced
         trace "[...] gen opV "+opNr+" nr="+nrVoiced+"00 syxoff="+syxOff;
         s = templV;
         s.replace("Operator 1", "Operator "+opNr);
         s.replace("$(NR)", String(opNr));
         s.replace("id=d_op", "id=d_op"+opNr);
         s.replace(" nr=20", " nr="+nrVoiced);
         s.replace(" shift=164", " shift="+syxOff);
         outV.append(s);

         // Unvoiced
         trace "[...] gen opN "+opNr+" nr="+nrUnvoiced+"00 syxoff="+syxOff;
         s = templN;
         s.replace("Operator 1", "Operator "+opNr);
         s.replace("$(NR)", String(opNr));
         s.replace("id=d_op", "id=d_op"+opNr);
         s.replace(" nr=21", " nr="+nrUnvoiced);
         s.replace(" shift=164", " shift="+syxOff);
         outN.append(s);

         // Next op
         opNr++;
         nrVoiced += 2;
         nrUnvoiced += 2;
         syxOff += 35+27;
      }

      String out = outV + outN;

      out.saveLocal("yamaha_fs1r_op.tmp");
      trace "[...] wrote \"yamaha_fs1r_op.tmp\"";
   }
}
