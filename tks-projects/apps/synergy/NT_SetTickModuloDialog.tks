// ----
// ---- file   : NT_SetTickModuloDialog.tks
// ---- author : Bastian Spiegel <bs@tkscript.de>
// ---- legal  : (c) 2017-2025 by Bastian Spiegel.
// ----          Distributed under terms of the GNU LESSER GENERAL PUBLIC LICENSE (LGPL). See
// ----          http://www.gnu.org/licenses/licenses.html#LGPL or COPYING for further information.
// ----
// ---- info   : This is part of the "syntracker" sequencer.
// ----
// ---- created: 10Feb2017
// ---- changed: 14Jul2017, 28Feb2025
// ----
// ----
// ----
module MNT_SetTickModuloDialog;

use namespace ui;
use namespace st2;


class NT_SetTickModuloDialog extends ActionConsumer {
   NT_TickDurationDialog *dlg;
   NT_PatternView *pattern_view;


   public method run(NT_PatternView _patternView, int _modulo) {
      pattern_view <= _patternView;

      if(null == dlg)
      {
         dlg <= NT_TickDurationDialog.New("Set tick modulo (highlighting)",
                                          "Modulo (ticks/steps):",
                                          23,
                                          24,
                                          false, // checkbox alltracks
                                          this
                                          );
      }

      if(_modulo < 0)
      {
         dlg.setTicks(-_modulo * current_song.ppq, pattern_view.step_resolution);
      }
      else
      {
         dlg.setTicks(_modulo, pattern_view.step_resolution);
      }
      dlg.showCentered();
   }

   public =replay= virtual consumeAction(Action _action) : boolean {
      if(@(_action.getActionProvider()) == @(dlg))
      {
         if(NT_TickDurationDialog.ACTION_CANCEL != _action.getActionName())
         {
            int ticks = dlg.getTicks();

            if(ticks >= 0)
            {
               pattern_view.highlightTickModuloDialog2(ticks);
            }
         }
         else
         {
            Global.Debug("NT_SetTickDurationDialog was canceled");
         }
         return true;
      }
      return false;
   }
}
