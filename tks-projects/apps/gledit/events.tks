// ----
// ---- file   : events.tks
// ---- author : Bastian Spiegel <bs@tkscript.de>
// ---- legal  : (c) 2006-2020 by Bastian Spiegel. 
// ----          Distributed under terms of the GNU LESSER GENERAL PUBLIC LICENSE (LGPL). See 
// ----          http://www.gnu.org/licenses/licenses.html#LGPL or COPYING for further information.
// ----
// ---- info   : This is part of the "GL Edit" application.
// ----
// ---- changed: 14Sep2006, 17Sep2006, 20Sep2006, 15Oct2007, 20Oct2007, 21Oct2007, 22Oct2007, 
// ---           ...
// ----          18Feb2011, 20Feb2011, 25Feb2011, 28Feb2011, 02Jul2011, 26Jun2012, 15May2013
// ----          31May2013, 09Aug2014, 12Aug2014, 15Aug2014, 30Jan2015, 27Feb2015, 26Jul2015
// ----          24Oct2015, 25Oct2015, 02Sep2017, 04Jan2018, 24Apr2020, 12Jun2020
// ----
// ----
// ----
module MEvents;

use namespace ui;
use namespace gledit;


// (note) this is for asynchronous thread notifications


function onEvent(String _ev) {
   ////trace "xxx onEvent: ev="+_ev;
   switch(_ev)
   {
      case Events.EV_REDRAWALL:
         Events.HandleRedrawAll();
         break;

      case RootForm.EV_SYN_KEY:
         Events.HandleSynKey();
         break;
   }
}


class Events {

   define String EV_REDRAWALL;  // used by e.g. Arranger timeline (in marker play mode)

   protected static boolean b_redraw_all_pending;
   protected static boolean b_synkey_pending;

   static ResetAllEvents() {
      // after viewport change (resize, fullscreen toggle)
      b_redraw_all_pending = false;
      b_synkey_pending = false;
   }

   static SendRedrawAll() {
      if(!b_redraw_all_pending)
      {
         b_redraw_all_pending = true;
         SDL.sendEvent(EV_REDRAWALL);
      }
   }

   static HandleRedrawAll() {
      b_redraw_all_pending = false;
      UI.RedrawAll();
   }

   static SendSynKey() {
      // (todo) pending flag issue when opening file dialog via synkey (->investigate)
      // if(!b_synkey_pending)
      // {
      //    b_synkey_pending = true;
         SDL.sendEvent(RootForm.EV_SYN_KEY);
      // }
   }

   static HandleSynKey() {
      b_synkey_pending = false;
      root_form.processSynKeyQueue();
   }

}


use onEvent for SDL.onEvent;
