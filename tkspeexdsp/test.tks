
use tkspeexdsp;

float outFactor = 0.5;

// Sine input buffer
FloatArray faIn;
faIn.allocAndFill(32768, 0);
float a = 0;
float w = (2PI * 64)/faIn.numElements;
int k = 0;
loop(faIn.numElements)
{
   faIn[k++] = sin(a);
   a += w;
}

trace faIn;

// Resampled output buffer
FloatArray faOut;
faOut.allocAndFill(faIn.numElements * outFactor, 0);

SpeexResampler srs;
if(!srs.init(1/*numCh*/,
             44100/*sampleRateIn*/,
             44100 * outFactor/*sampleRateOut*/,
             4/*quality(0..10,def=4)*/
             ))
   trace "srs init failed";

srs.process(0/*chIdx*/,
            faIn,
            faIn.numElements,
            faOut,
            faOut.numElements
            );

trace faOut;

File f;
if(f.openLocal("out.raw", IOS_OUT))
{
   k = 0;
   loop(faOut.numElements)
   {
      f.f32 = faOut[k++];
   }
   f.close();
}
