use tkmidi;

//String DEV_NAME = "MONTAGE-1";
String DEV_NAME = "MONTAGE Port1";

int note = 4*12;

Buffer b;
b.size = 32;

MIDIOut midiout;

function onMIDITimer(MIDITimer _timer) {
   trace "play note "+note;
   b.offset = 0;
   b.i8 = 0x90;
   b.i8 = note;
   b.i8 = 127;
   b.i8 = 0x80;
   b.i8 = note;
   b.i8 = 0;
   midiout.sendBuffer(b);
   note++;
}

MIDITimer timer;

trace "opening timer";
timer.open(null/*name*/);

trace "opening MIDI output device \""+DEV_NAME+"\"";
if(midiout.openByName(DEV_NAME))
{
   trace "ok, MIDI output device \""+midiout.deviceName+"\" opened (deviceIdx="+midiout.deviceIdx+")";
}
else
{
   trace "failed to open MIDI output device \""+DEV_NAME+"\"";
   exit(10);
}

trace "starting timer";
timer.start(0/*delayMS*/, 120/*intervalMS*/, onMIDITimer);

TKS.sleep(5000);

trace "stopping timer";
timer.stop();

TKS.sleep(250);
trace "exiting..";
