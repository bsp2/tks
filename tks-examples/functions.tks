
class C {

   sayHello { stdout "Hello"; }
   sayWorld compile { print ", world.\n"; }

   public function f_dist(float x, y, z):float {
      return sqrt(x*x+y*y+z*z);
   }

   public method f_noargs {
      return "42";
   }

   public method f_noargs_int : int {
      return "42";
   }

   public method f_local1_ret(int x):int {
      return 42*x;
   }

   public method f_local1(local x) {
      return 42*x;
   }

   public method f_instanceof(x,y) : List {
      if(x instanceof String)
      {
         String s<=x;
         s.append(y); s.append("f"); s.append("2"); 
      }
      else
         print "fail";
      return x;
   }

   public method f_dynamic(x,y) : var {
      x.append(y);
      x.append("f");
      x.append("2"); 
      return x;
   }

   public function f_newstring() : String {
      local String s; return deref s;
   }

   public method f_array1(int[] ia) {
      return ia.numElements;
   }

   public method f_array2(int ia[]) {
      return ia.numElements;
   }

   public method f_array3(var v[]) {
      return v.numElements==10;
   }

   public method f_array4_ret(v[]) returns boolean {
      return v.numElements==10;
   }
}

function main() {
   C c;

   c.sayHello();
   c.sayWorld();

   if(C.f_dist(2,3,4)==sqrt(29))
      print "c.f_dist(2,3,4)==sqrt(29)         ok (true)";
   else
      print "c.f_dist(2,3,4)==sqrt(29)         NOK (false!=true)";

   if(c.f_noargs()=="42")
      print "c.f_noargs()==\"42\"                ok (true)";
   else
      print "c.f_noargs()==\"42\"                NOK (false!=true)";

   if(c.f_noargs_int()==42)
      print "c.f_noargs_int()==42              ok (true)";
   else
      print "c.f_noargs_int()==42              NOK (false!=true)";

   if(c.f_local1_ret(2)==84)
      print "c.f_local1_ret(2)                 ok (true)";
   else
      print "c.f_local1_ret(2)                 NOK (false!=true)";

   if(c.f_local1(2)==84)
      print "c.f_local1(2)                     ok (true)";
   else
      print "c.f_local1(2)                     NOK (false!=true)";

   if( (c.f_instanceof("a","1")) =={"a1f2"})
      print "f_instanceof(\"a\",\"1\")=={\"a1f2\"}   ok (true)";
   else
      print "f_instanceof(\"a\",\"1\")=={\"a1f2\"}   NOK (false!=true)";

   if( (c.f_dynamic("a","1")=="a1f2") )
      print "c.f_dynamic(\"a\",\"1\")==\"a1f2\"      ok (true)";
   else
   {
      print "c.f_dynamic(\"a\",\"1\")==\"a1f2\"      NOK (false!=true)";
      trace c.f_dynamic("a","1");
   }

   if(C.f_newstring() instanceof String)
      print "c.f_newstring() instanceof String ok (true)";
   else
      print "c.f_newstring() instanceof String NOK (false!=true)";

   if(c.f_array1([1,2,3])==3)
      print "c.f_array1([1,2,3])==3            ok (true)";
   else
      print "c.f_array1([1,2,3])==3            NOK (false!=true)";

   if(c.f_array2([4,5,6,7])==4)
      print "c.f_array2([4,5,6,7])==4          ok (true)";
   else
      print "c.f_array2([4,5,6,7])==4          NOK (false!=true)";

   var a[10]; a[9]=10;
   if(c.f_array3(a)==true)
      print "c.f_array3(a)==true               ok (true)";
   else
      print "c.f_array3(a)==true               NOK (false!=true)";

   if(c.f_array4_ret(a)==true)
      print "c.f_array4_ret(a)==true           ok (true)";
   else
      print "c.f_array4_ret(a)==true           NOK (false!=true)";
}
