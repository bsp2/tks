
use namespace ui;


// <class.png>
class RootForm : XMLForm {

   Button *bt_quit;


   // <ui_init.png>
   public method init() : boolean {

      if(initPakFile("test_flowlayout.xfm"))
      {
         autoResolveIds(this);
         return true;
      }

      return false;
   }

   // <ui_kbd.png>
   public virtual onKey(Key _k) : boolean {
      trace "[...] k.name="+_k.name+" k.code="+_k.code+" k.mod="+_k.mod+" k.unicode="+_k.unicode;
      switch(_k.pressed)
      {
         case VKEY_ESCAPE:
            UI.Stop();
            return true;
      }
      return false;
   }

   // <ui_consume.png>
   public virtual consumeAction(Action _ac) : boolean {

      String acName <= _ac.getActionName();
      ActionProvider ap <= _ac.getActionProvider();
      // StringAction *sac;
      // IntAction *iac;

      //trace "xxx RootForm::consumeAction: acName=\""+acName+"\".";

      switch(@(ap))
      {
         case @(bt_quit):
            UI.Stop();
            return true;
      }

      return false;
   }

}


// loop(20)
//   trace "........";

UI.ConfigureHiDPI();
UI.Initialize(Arguments);

function AddFonts() {
   FontResource *fr;
   int fsz;

   fsz = 7;
   fr <= FT2PakFileFontResource.New("tkui:fonts/default.ttf", "default", Font.FONT_STYLE_NORMAL, fsz);
   fr.setEnableMonochrome(false);
   UI.AddFontResource(deref fr);
   UI.AddFontAlias("default "+fsz, "big9");

   fsz = 18;
   fr <= FT2PakFileFontResource.New("tkui:fonts/default.ttf", "default", Font.FONT_STYLE_NORMAL, fsz);
   fr.setEnableMonochrome(false);
   UI.AddFontResource(deref fr);
   UI.AddFontAlias("default "+fsz, "big6");

   fsz = 22;
   fr <= FT2PakFileFontResource.New("tkui:fonts/default.ttf", "default", Font.FONT_STYLE_NORMAL, fsz);
   fr.setEnableMonochrome(false);
   UI.AddFontResource(deref fr);
   UI.AddFontAlias("default "+fsz, "big5");
}

AddFonts();

RootForm root_form;
if(!root_form.init())
   die "failed to init RootForm";

UI.SetRootForm(root_form);
UI.OpenWindow(640, 240);
UI.SetKeyboardFocus(root_form.bt_quit);
UI.Run();
UI.Exit();

trace "cu";
