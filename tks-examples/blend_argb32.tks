int NUM_BITMAP_PIXELS = 1024*256;

IntArray src, dst;
src.alloc(NUM_BITMAP_PIXELS);
src.numElements = src.maxElements;
src.fill(0xAF337799);

dst.alloc(NUM_BITMAP_PIXELS);
dst.numElements = dst.maxElements;
dst.fill(0x3Fffdd66);

function test_blend_argb32_native() compile {
   local int n = NUM_BITMAP_PIXELS;

   local int iter = 0;
   while(iter++ < 20)
   {
      local int i;
      for (i=0; i<n; i++)
      {
         local int a = src[i];
         local int b = dst[i];
         local int Alpha  = (a>>24) & 255;
         
         local int dstrb = a      & 0xFF00FF;
         local int dstag = a >> 8 & 0xFF00FF;
         local int srcrb = b      & 0xFF00FF;
         local int srcag = b >> 8 & 0xFF00FF;
         local int drb = ((srcrb - dstrb) * Alpha)>>8;
         local int dag = ((srcag - dstag) * Alpha)>>8;
         a = (drb + dstrb)      & 0x00FF00FF;
         b = (dag + dstag) << 8 & 0xFF00FF00;
         
         dst[i] = a|b;
      }
   }
}


int ms = milliSeconds();

test_blend_argb32_native();

ms = milliSeconds() - ms;

trace "ms="+ms;

UnsignedInteger ui = dst[0];
trace "dst[0]="+ui.printf("%08x");

