
use tksdl;
use tkopengl;
use tkmath;

float frot=0;
int numframesrendered=0;


function onDraw() {
    float dt=FPS.precision;
    glClearColor(0,0,0.2,1);
    glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT);
    if( !(++numframesrendered&127) )
      trace "FPS.real="+FPS.real;
    zglInitPerspective(1.3, 45.0, 0.1, 100.0);
    glDisable(GL_CULL_FACE);
    glLoadIdentity();
    Vector4f v;
    Vector4f vRot;
    v.init(1,0,0,0);
    Matrix4f m;
    Matrix4f mInv;
    m.initEulerXYZ(frot, frot, frot);
    ////trace "m.columnMajor="+m.columnMajor;
    //m.initIdentity();
    m.set(2, 3, -5);
    trace "xxx frot="+frot+" m="+m.string;
    //glTranslatef(0,0,-5);
    m.invert() => mInv;
    mInv.mulv(v) => vRot;
    //vRot = [0,1,0,0];

    zglLoadMatrixTransposef(m);
    glColor3f(0.9,0.9,0.9);
    glBegin(GL_LINES);
    glVertex3f(0,0,0);
    glVertex3f(v.x, v.y, v.z);
    glEnd();

    glColor3f(1,0,0);
    glBegin(GL_LINES);
    glVertex3f(0,0,0);
    glVertex3f(vRot.x, vRot.y, vRot.z);
    glEnd();

    frot+=dt*0.01;
    wrap frot 0 2PI;
}

function onMouse(int _x, int _y, int _cbs, int _nbs) {
   //trace "x="+_x+" y="+_y+" cbs="+_cbs+" nbs="+_nbs;
}

function onKeyboard(Key _k) {
   switch(_k.pressed)
   {
      case VKEY_ESCAPE:
         SDL.exitEventLoop();
         break;
   }
}

function main() {
    Viewport.openWindow(640, 480);
    use callbacks;
    FPS.tickInterval=1000.0/60;
    FPS.limit=25;
    trace "xxx entering eventloop";
    SDL.eventLoop();
}

