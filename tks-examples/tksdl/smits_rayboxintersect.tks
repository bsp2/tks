
function SmitsRayBoxIntersect(Vector origin, Vector dir, Vector boxmin, Vector boxmax) {
   // Smits’ method
   // adapted from http://www.cs.utah.edu/~awilliam/box/box.pdf
   float tmin, tmax, tymin, tymax, tzmin, tzmax;
   float dirx = 1.0f / (dir.x-origin.x);
   if (dir.x >= 0) {
      tmin = (boxmin.x - origin.x) * dirx;
      tmax = (boxmax.x - origin.x) * dirx;
   }
   else {
      tmin = (boxmax.x - origin.x) * dirx;
      tmax = (boxmin.x - origin.x) * dirx;
   }
   float diry = 1.0f / (dir.y-origin.y);
   if (dir.y >= 0) {
      tymin = (boxmin.y - origin.y) * diry;
      tymax = (boxmax.y - origin.y) * diry;
   }
   else {
      tymin = (boxmax.y - origin.y) * diry;
      tymax = (boxmin.y - origin.y) * diry;
   }
   if ( (tmin > tymax) || (tymin > tmax) )
      return false;
   if (tymin > tmin)
      tmin = tymin;
   if (tymax < tmax)
      tmax = tymax;
   float dirz = 1.0f / (dir.z-origin.z);
   if (dir.z >= 0) {
      tzmin = (boxmin.z - origin.z) * dirz;
      tzmax = (boxmax.z - origin.z) * dirz;
   }
   else {
      tzmin = (boxmax.z - origin.z) * dirz;
      tzmax = (boxmin.z - origin.z) * dirz;
   }
   if ( (tmin > tzmax) || (tzmin > tmax) )
      return false;
   if (tzmin > tmin)
      tmin = tzmin;
   if (tzmax < tmax)
      tmax = tzmax;
   return 1;
   ///float t0=0,t1=1;
   //return ( (tmin < t1) && (tmax > t0) );
}
