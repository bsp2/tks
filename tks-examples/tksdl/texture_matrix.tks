
use tksdl;
use tkopengl;

float frot=0;
int numframesrendered=0;

Texture tex;
tex.loadImage("escher.png", 0,0,0);
tex.flags = TEX_REPEAT_S | TEX_REPEAT_T | TEX_MINFILTERLINEAR;

function onDraw() {

   float dt=FPS.precision;
   glClearColor(0,0,0.2,1);
   glClear(GL_COLOR_BUFFER_BIT);

   if( !(++numframesrendered&127) )
      trace "FPS.real="+FPS.real;

   zglInitOrtho(2, 2);

   glColor4f(1,1,1,1);

   glMatrixMode(GL_TEXTURE);
   glTranslatef( 0.5, 0.5, 0);
   glRotatef(frot, 0,0,1);
   glTranslatef( -0.5,  -0.5, 0);

   glMatrixMode(GL_MODELVIEW);
   glScalef(1.5, 1.5, 1);

   tex.bind();
   tex.enable();

   glBegin(GL_QUADS);
   glTexCoord2f(0, 0);
   glVertex2f(-1,-1);

   glTexCoord2f(1, 0);
   glVertex2f( 1,-1);

   glTexCoord2f(1, 1);
   glVertex2f( 1, 1);

   glTexCoord2f(0, 1);
   glVertex2f(-1, 1);
   glEnd();

   tex.disable();

   frot += dt;
   wrap frot 0 360;
}

function onOpen() {
   tex.upload();
}

function onKeyboard(Key _k) {
   switch(_k.pressed)
   {
      case VKEY_ESCAPE:
         SDL.exitEventLoop();
         break;
   }
}

function main() {
   use callbacks;

   //FPS.tickInterval=1000.0/60;
   //FPS.limit=30;
   //FPS.limit=60;

   Viewport.openWindow(256, 256);
   Viewport.swapInterval(1);

   trace "xxx entering eventloop";
   SDL.eventLoop();
}
