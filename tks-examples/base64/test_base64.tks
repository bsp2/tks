
Buffer b;
String sDecOrig = "hello, world.";  // => "aGVsbG8sIHdvcmxkLg=="
int sCurLen = 1;
loop(sDecOrig.length-1)
{
   trace "--------------------";
   String sEnc;
   String sDec;
   b.size = 256;
   sDec = "hello, world.";
   b.writeString(sDec, 0, sCurLen/*asciiz*/);
   trace "[dbg] raw b.offset="+b.offset;
   b.base64Encode(sEnc);
   trace "[dbg] sEnc=\""+sEnc+"\"";

   b.size = 16;  // reallocate buffer
   b.base64Decode(sEnc);
   trace "[dbg] dec b.offset="+b.offset;
   sDec = "";
   b.offset = 0;
   b.readString(sDec, sCurLen);
   trace "[dbg] sDec=\""+sDec+"\"";
   if(sDecOrig.substring(0, sCurLen) == sDec)
   {
      trace "[...] base64 enc/dec len="+sCurLen+" OK";
   }
   else
   {
      trace "[---] base64Decode() len="+sCurLen+" failed.";
   }

   sCurLen++;
}

