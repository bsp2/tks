
String buf;
buf.alloc(8192);
String cmd = "defaults read ~/Library/Preferences/com.apple.HIToolbox.plist AppleSelectedInputSources";
psystem(cmd, 'r', buf);
// trace buf;
StringArray a <= buf.splitChar('\n');
String *line;
foreach line in a
{
   if(line & "\"KeyboardLayout Name\"")
   {
      line.replace("\"KeyboardLayout Name\" = ", "");
      line.replace("\"", "");
      line.replace(";", "");
      line.trim();  // => "PC-Tastatur, Deutsch", "Finnish", "U.S.", ""(CN Wubi), "Arabic", ..
      trace line;
      exit(0);
   }
}
trace "<unknown>";
