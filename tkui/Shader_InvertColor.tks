// ----
// ---- file   : Shader_ColorGrading.tks
// ---- author : Bastian Spiegel <bs@tkscript.de>
// ---- legal  : (c) 2018-2025 by Bastian Spiegel. 
// ----          Distributed under terms of the GNU LESSER GENERAL PUBLIC LICENSE (LGPL). See 
// ----          http://www.gnu.org/licenses/licenses.html#LGPL or COPYING for further information.
// ----
// ---- info   : This is part of the "ui" toolkit.
// ----
// ---- created: 27Nov2018
// ---- changed: 28Nov2018, 03Dec2018, 06Feb2023, 28Mar2024, 13Sep2025
// ----
// ----
// ----

module MShader_InvertColor;

namespace ui;


class Shader_InvertColor : Shader {

   // Inputs:
   //   tex[0] : Texture (GL_TEXTURE_2D)

   static String vs_src =
      "uniform mat4 u_transform; \n"
      " \n"
      "ATTRIBUTE vec2 a_vertex; \n"
      "ATTRIBUTE vec2 a_uv; \n"
      " \n"
      "VARYING_OUT vec2 v_uv; \n"
      " \n"
      "void main(void) { \n"
      "  gl_Position = u_transform * vec4(a_vertex,0,1); \n"
      "  v_uv = a_uv; \n"
      "}"
      ;

   static String fs_src =
      "uniform sampler2D u_sampler; \n"
      "uniform vec4 u_color_fill; \n"
      " \n"
      "VARYING_IN vec2 v_uv; \n"
      " \n"
      "void main(void) { \n"
      "  vec2 uv = v_uv; \n"
      "  vec4 c = TEXTURE2D(u_sampler, uv) * u_color_fill; \n"
      "  c = vec4(1.0 - c.r, 1.0 - c.g, 1.0 - c.b, c.a); \n"
      "  FRAGCOLOR = c; \n"
      "}"
      ;

   public virtual create() : boolean {
      if(createFromStrings(vs_src, fs_src))
      {
         sdvg_BindShader(sdvg_shader_idx);
         sdvg_Uniform1i("u_sampler", 0);
         if(Configuration.debugLevel >= 2)
            trace "[dbg] ui::Shader_InvertColor::create: OK.";
         sdvg_BindShader(0);
         return true;
      }
      else
      {
         trace "[!!!] ui::Shader_InvertColor::create: failed";
      }
      return false;
   }

}
