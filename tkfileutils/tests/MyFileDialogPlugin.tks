
module MMyFileDialogPlugin;

use namespace ui;


class MyFileDialogPlugin : FileDialogPlugin {
   
   protected XMLForm *fx;

   protected Label *lb_previewpath_dir;
   protected Label *lb_previewpath_file;
   protected Label *lb_selectpath_dir;
   protected Label *lb_selectpath_file;


   public method init() {
      setLayout(SuperBorderLayout);

      fx <= XMLForm.New_PakFile("MyFileDialogPlugin.xfm");

      Layer *l <= fx.findLayerById("tp_head");

      lb_previewpath_dir  <= fx.findLayerById("lb_previewpath_dir");
      lb_previewpath_file <= fx.findLayerById("lb_previewpath_file");
      lb_selectpath_dir   <= fx.findLayerById("lb_selectpath_dir");
      lb_selectpath_file  <= fx.findLayerById("lb_selectpath_file");

      addLayer(l, Layout.CENTER);

      setLayoutWeight2f(1, 1);
   }

   public virtual method resetFileDialogPlugin() { 
      lb_previewpath_dir .setCaption("-");
      lb_previewpath_file.setCaption("-");

      lb_selectpath_dir .setCaption("-");
      lb_selectpath_file.setCaption("-");
   }

   public virtual method onFileDialogPreviewFile(String _dirName, String _fileName) { 
      trace "xxx MyFileDialogPlugin::onFileDialogPreviewFile: absFileName=\""+_dirName+_fileName+"\".";
      if(_dirName.endsWith("/"))
      {
         String t;
         _dirName.substring(0, _dirName.length-2) => t;
         _dirName <= t;
      }
      lb_previewpath_dir.setCaption(_dirName);
      lb_previewpath_file.setCaption(_fileName);

      relayoutLabels();
   }
   
   public virtual method onFileDialogSelectFile(String _dirName, String _fileName) { 
      trace "xxx MyFileDialogPlugin::onFileDialogSelectFile: absFileName=\""+_dirName+_fileName+"\".";
      if(_dirName.endsWith("/"))
      {
         String t;
         _dirName.substring(0, _dirName.length-2) => t;
         _dirName <= t;
      }
      lb_selectpath_dir.setCaption(_dirName);
      lb_selectpath_file.setCaption(_fileName);
      
      relayoutLabels();
   }

   protected method relayoutLabels() {
      Layer l <= lb_selectpath_dir.getParent();
      l <= l.getParent();

      l.invalidateMinSizeCache();
      l.invalidateChildContainerMinSizeCaches();
      // // l.invalidatePreferredSizes();
      // // l.invalidateMinimumSizes();
      l.layoutHierarchy();
      l.redraw();
   }

}
