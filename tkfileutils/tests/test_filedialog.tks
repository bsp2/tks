
// 14Jul2010, 16Jul2010

module Main;

use namespace ui;

UI.Initialize(Arguments);
// UI.SetEnableTransparentLayers(false);


class TestPanel : Panel {

   protected FileDialog file_dialog;
   protected Button *bt_test;

   protected MyFileDialogPlugin file_plugin;


   public virtual consumeAction(Action _ac) returns boolean {
      ActionProvider ap <= _ac.getActionProvider();

      switch(@(ap))
      {
         case @(bt_test):
            trace "xxx bt_test clicked.";
            file_dialog.resetFileDialog(this);
            file_dialog.showNearMouse(0, 0);
            return true;

         case @(file_dialog):
            switch(_ac.getActionName())
            {
               case FileDialog.ACTION_OK:
                  trace "[dbg] ok, selected dir=\""+file_dialog.getSelectedDirName()+"\", file=\""+file_dialog.getSelectedFileName()+"\".";
                  break;

               case FileDialog.ACTION_CANCEL:
                  trace "[dbg] file dialog was CANCELED.";
                  break;
            }
            return true;
      }

      return Panel::consumeAction(_ac);
   }

   public virtual endXFMTag(AbstractXMLForm _form, HashTable _attributes) {
      Panel::endXFMTag(_form, _attributes);
   }

   public method initTestPanel(XMLForm fx) {
      bt_test <= fx.findLayerById("bt_test");

      file_dialog.initFileDialog();
      file_dialog.setPath("h:/samples");

      file_plugin.init();
      file_dialog.installPlugin(file_plugin);

      UI.SetKeyboardFocus(bt_test);
   }

}

function main() {

   XMLForm *fx;

   fx <= XMLForm.New_PakFile("test_filedialog.xfm");
   if(null != fx)
   {
      TestPanel pnTest <= fx.findLayerById("pn_test");
      pnTest.initTestPanel(fx);

      UI.SetRootForm(fx);
      UI.OpenWindow(800, 600);
      UI.Run();
   }
}
