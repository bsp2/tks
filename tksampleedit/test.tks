
use tksdl;
use tkopengl;
use tksampleedit;

use namespace ui;

int numframesrendered=0;


TkSampleEditTest test;


class TkSampleEditTest {

   FloatArray samples;

   define float SAMPLE_RATE = 48000.0;
   define float FREQ = 32;
   define int NUM_SAMPLES = 48000.0;
   define int NUM_CH = 1;

   SampleView sampleview;

   method init() {
      generateSample();
      sampleview.initSampleView();
      sampleview.setSample(null, samples, NUM_CH, SAMPLE_RATE);
      ////sampleview.setZoom(0.05);
   }

   method generateSample() {
      int numFloats = NUM_SAMPLES * NUM_CH;
      float w = 2PI * (FREQ/SAMPLE_RATE);
      float a = 0;
      samples.alloc(numFloats);
      loop(NUM_SAMPLES)
      {
         loop(NUM_CH)
         {
            samples.add(sin(a));
         }
         a += w;
         while(a >= 2PI)
            a -= 2PI;
      }
   }

   method run() {
      init();

      UI.Initialize(Arguments);
      UI.SetEnableTransparentLayers(false);
      UI.SetFrameRate(60);
      UI.SetRootLayer(sampleview);
      UI.OpenWindow(800,600);
      UI.SetKeyboardFocus(sampleview);
      UI.Run();
   }
}


test.run();
